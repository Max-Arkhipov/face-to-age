# Face Age Estimation

### Описание проекта

Проект Face Age Estimation решает задачу предсказания возраста человека по фотографии лица. Используется датасет UTKFace￼ с изображениями лиц и метками возраста.

Модель реализована на PyTorch Lightning и поддерживает несколько архитектур:  
	-	SimpleRegressor — простой регрессионный блок над изображением.  
	-	ConvRegressor — сверточная сеть для предсказания возраста.  

Проект интегрирован с MLflow для логирования экспериментов и DVC для управления данными и результатами.

Применяемые техники:  
	- Предобработка изображений: изменение размера, нормализация, аугментации.  
	- Трёхуровневый workflow: подготовка данных → обучение → инференс.  
	- Использование DVC для безопасного хранения больших файлов (чекпоинтов и датасета) вне GitHub.  

### Метрики качества

В процессе обучения и валидации используются следующие метрики:

- **MAE (Mean Absolute Error)**  
  Основная метрика качества модели. Показывает среднее абсолютное отклонение предсказанного возраста от истинного значения.  
  Метрика измеряется в годах, поэтому легко интерпретируема. Чем меньше значение MAE, тем точнее модель.

- **MSE (Mean Squared Error)**  
  Используется как функция потерь при обучении  
  Сильнее штрафует большие ошибки и способствует более стабильному обучению модели.

### Логирование метрик

- Все метрики логируются с помощью **MLflow**.
- Для каждого запуска сохраняются значения loss и MAE на train и validation


## Setup

Для запуска проекта необходимо подготовить окружение и зависимости.  

1. Клонируем репозиторий

		git clone https://github.com/Max-Arkhipov/face-to-age.git

3. Задаем виртуальное окружение

		conda create -n <имя_окружения> python=3.12

3. Установка зависимостей через Poetry

		poetry install

4. Настройка DVC

		dvc pull  

Эта команда скачает датасет и необходимые файлы для обучения и инференса из удалённого хранилища (Google Drive).  

5. Запуск MLflow для мониторинга

		mlflow ui --host 127.0.0.1 --port 8080

Доступ к интерфейсу по адресу: http://127.0.0.1:8080￼


## Train

Скрипт обучения предназначен для запуска полного пайплайна тренировки модели оценки возраста по лицу.

Во время выполнения:

- Загружает обучающие и валидационные данные из `data/train/` и `data/val/`.
- Если данные отсутствуют локально, автоматически подтягивает их из удалённого DVC-хранилища (Google Drive).
- Выполняет препроцессинг изображений (resize, нормализация, аугментации).
- Инициализирует модель и оптимизатор.
- Запускает процесс обучения.
- Сохраняет лучший чекпоинт модели в `checkpoints/best_model.pth`.
- Логирует метрики обучения (loss, MAE) через MLflow.

Пример запуска

	python -m face_to_age.train

Если данных нет локально, скрипт автоматически подтянет их через DVC.

Параметры задаются через конфиг configs/config.yaml:  
- dataset: пути к датасетам train, val, test   
- dataloader: размер батча и количество потоков  
- preprocessing: параметры аугментаций и нормализации  
- training: количество эпох, оптимизатор, функция потерь  
- model: выбор модели (simple_regressor или conv_regressor)  
- logger: настройки MLflow  
- paths: путь для сохранения чекпоинтов и предсказаний  

После тренировки чекпоинт модели сохраняется в checkpoints/best_model.pth  


## Infer

- Скрипт загружает модель из checkpoints/best_model.pth.
- Делает предсказания для изображений из data/predict/.
- Сохраняет результаты в CSV файл preds/predictions.csv.

Пример запуска

	python -m face_to_age.infer  

Если данных нет локально, скрипт автоматически подтянет их через DVC.

Параметры задаются через конфиг configs/config.yaml:  
- dataset: пути к датасету predict   
- dataloader: размер батча и количество потоков  
- preprocessing: параметры аугментаций и нормализации  


